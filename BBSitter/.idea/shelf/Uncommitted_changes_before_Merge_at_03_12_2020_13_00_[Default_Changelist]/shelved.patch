Index: app/src/main/java/com/bbsitter/bbsitter/OpcionesMenuCanguro/Inicio/MapsFragmentCanguros.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.bbsitter.bbsitter.OpcionesMenuCanguro.Inicio;\r\n\r\nimport android.Manifest;\r\nimport android.annotation.SuppressLint;\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageManager;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapRegionDecoder;\r\nimport android.graphics.drawable.BitmapDrawable;\r\nimport android.location.Location;\r\nimport android.location.LocationManager;\r\nimport android.os.Bundle;\r\nimport android.provider.Settings;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.core.app.ActivityCompat;\r\nimport androidx.core.content.ContextCompat;\r\nimport androidx.fragment.app.Fragment;\r\n\r\nimport com.bbsitter.bbsitter.Clases.Canguro;\r\nimport com.bbsitter.bbsitter.R;\r\nimport com.google.android.gms.maps.CameraUpdateFactory;\r\nimport com.google.android.gms.maps.GoogleMap;\r\nimport com.google.android.gms.maps.OnMapReadyCallback;\r\nimport com.google.android.gms.maps.SupportMapFragment;\r\nimport com.google.android.gms.maps.model.BitmapDescriptorFactory;\r\nimport com.google.android.gms.maps.model.LatLng;\r\nimport com.google.android.gms.maps.model.Marker;\r\nimport com.google.android.gms.maps.model.MarkerOptions;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\nimport com.google.firebase.firestore.QueryDocumentSnapshot;\r\nimport com.google.firebase.firestore.QuerySnapshot;\r\n\r\nimport java.util.List;\r\n\r\nimport es.dmoral.toasty.Toasty;\r\n\r\nimport static android.content.Context.LOCATION_SERVICE;\r\nimport static com.firebase.ui.auth.AuthUI.getApplicationContext;\r\n\r\npublic class MapsFragmentCanguros extends Fragment {\r\n\r\n    private LocationManager locationManager;\r\n\r\n    FirebaseFirestore bbdd = FirebaseFirestore.getInstance();\r\n\r\n\r\n    // Toca poner los marcadores de los canguros que salgan en la lista\r\n\r\n    private OnMapReadyCallback callback = new OnMapReadyCallback() {\r\n\r\n        /**\r\n         * Manipulates the map once available.\r\n         * This callback is triggered when the map is ready to be used.\r\n         * This is where we can add markers or lines, add listeners or move the camera.\r\n         * In this case, we just add a marker near Sydney, Australia.\r\n         * If Google Play services is not installed on the device, the user will be prompted to\r\n         * install it inside the SupportMapFragment. This method will only be triggered once the\r\n         * user has installed Google Play services and returned to the app.\r\n         */\r\n        @Override\r\n        public void onMapReady(GoogleMap googleMap) {\r\n\r\n            final GoogleMap miGoogleMap = googleMap;\r\n\r\n            locationManager = (LocationManager) getActivity().getSystemService(LOCATION_SERVICE);\r\n\r\n            // Lo primero será obtener nuestra ubicacion actual y poner nuestro marcador para despues recorrer nuestra base de datos de canguro para que los situe en  el mapa\r\n\r\n            // Obtenemos nuestra ubicacion\r\n            // Usamo un try por si no tenemos activado el GPS\r\n            /*\r\n            try {\r\n                Location loc = locationManager.getLastKnownLocation(LocationManager.GPS_PROVIDER);\r\n            }\r\n            catch(Exception e){\r\n                alertDialogActivarGPS();\r\n            }\r\n            */\r\n\r\n            if (ActivityCompat.checkSelfPermission(getContext(), Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(getContext(), Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n                ActivityCompat.requestPermissions(getActivity(), new String[]{\r\n\r\n                        Manifest.permission.ACCESS_FINE_LOCATION,\r\n                        Manifest.permission.ACCESS_COARSE_LOCATION\r\n\r\n                },1000);\r\n            }\r\n\r\n\r\n            if (!locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER)){\r\n                    showAlert();\r\n            }\r\n\r\n            // Obtener nuestra ubicacion\r\n            /*\r\n            Location loc = locationManager.getLastKnownLocation(LocationManager.GPS_PROVIDER);\r\n            LatLng MIUBICACION = new LatLng(loc.getLatitude(), loc.getLongitude());\r\n            */\r\n            LatLng MIUBICACION = new LatLng(40.490797, -3.341996);\r\n\r\n            // MARCADOR PERSONALIZADO con una imagen nuestra\r\n            BitmapDrawable bitmapdraw = (BitmapDrawable) getResources().getDrawable(R.drawable.puntomarcadorubicacion);\r\n            Bitmap b = bitmapdraw.getBitmap();\r\n            Bitmap smallMarker = Bitmap.createScaledBitmap(b, 130, 130, false);\r\n\r\n\r\n            Marker marcador = miGoogleMap.addMarker(new MarkerOptions()\r\n                    .position(MIUBICACION)\r\n                    .title(\"Mi ubicación\"));\r\n\r\n            marcador.setIcon(BitmapDescriptorFactory.fromBitmap(smallMarker));\r\n\r\n            googleMap.moveCamera(CameraUpdateFactory.newLatLng(MIUBICACION));\r\n            googleMap.animateCamera(CameraUpdateFactory.newLatLngZoom(MIUBICACION, 15));\r\n            googleMap.getUiSettings().setZoomControlsEnabled(true);\r\n\r\n\r\n            // Lo segundo será recorrrer nuetro canguros y pintar cada uno, con su marcador, en el mapa.\r\n\r\n            bbdd.collection(\"canguros\")\r\n                    .get()\r\n                    .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {\r\n                        @Override\r\n                        public void onComplete(@NonNull Task<QuerySnapshot> task) {\r\n                            if (task.isSuccessful()) {\r\n\r\n                                for (QueryDocumentSnapshot document : task.getResult()) {\r\n\r\n                                    // Object localizacionCanguro = document.getData().get(\"Localizacion\");\r\n\r\n                                    String nombreCanguro = document.get(\"nombre\").toString();\r\n                                    String urlFotoCanguro = document.get(\"img\").toString();\r\n                                    Double Latitud = document.getDouble(\"latitud\");\r\n                                    Double Longitud = document.getDouble(\"longitud\");\r\n                                    String iudCanguro = document.getString(\"uid\");\r\n\r\n                                    /*\r\n                                    CircleImageView fotoCanguro = null;\r\n                                    Picasso.get().load(urlFotoCanguro).into(fotoCanguro);\r\n                                    */\r\n\r\n                                    BitmapDrawable bitmapdraw = (BitmapDrawable) getResources().getDrawable(R.drawable.marcadorbbsitter);\r\n                                    Bitmap b = bitmapdraw.getBitmap();\r\n                                    Bitmap smallMarker = Bitmap.createScaledBitmap(b, 110, 110, false);\r\n\r\n\r\n                                    LatLng ubicacionCanguro = new LatLng(Latitud, Longitud);\r\n                                    Marker marcador = miGoogleMap.addMarker(new MarkerOptions()\r\n                                                                            .position(ubicacionCanguro)\r\n                                                                            .title(nombreCanguro));\r\n                                    marcador.setIcon(BitmapDescriptorFactory.fromBitmap(smallMarker));\r\n\r\n                                    // Metemos dentro del TAG del marcador el iud del canguro para acceder a sus datos (firestore) y mostrarlos cuando hagan click en el marcador\r\n                                    marcador.setTag(iudCanguro);\r\n\r\n                                }\r\n\r\n                            } else {\r\n\r\n                                Toasty.error(getContext(), \"Error\", Toast.LENGTH_SHORT).show();\r\n                            }\r\n                        }\r\n                    });\r\n\r\n        }\r\n    };\r\n    \r\n\r\n    @Nullable\r\n    @Override\r\n    public View onCreateView(@NonNull LayoutInflater inflater,\r\n                             @Nullable ViewGroup container,\r\n                             @Nullable Bundle savedInstanceState) {\r\n\r\n\r\n        View view = inflater.inflate(R.layout.fragment_maps_canguros, container, false);\r\n\r\n\r\n        // ubicacion = (LocationManager) getSystemService(Context.LOCATION_SERVICE);\r\n\r\n        return view;\r\n\r\n    }\r\n\r\n    @Override\r\n    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\r\n\r\n        super.onViewCreated(view, savedInstanceState);\r\n\r\n        SupportMapFragment mapFragment =  (SupportMapFragment) getChildFragmentManager().findFragmentById(R.id.map);\r\n\r\n        if (mapFragment != null) {\r\n            mapFragment.getMapAsync(callback);\r\n            \r\n\r\n        }\r\n    }\r\n    private Location getLastKnownLocation() {\r\n        Location l=null;\r\n        @SuppressLint(\"RestrictedApi\") LocationManager mLocationManager = (LocationManager)getApplicationContext().getSystemService(LOCATION_SERVICE);\r\n        List<String> providers = mLocationManager.getProviders(true);\r\n        Location bestLocation = null;\r\n        for (String provider : providers) {\r\n            if(ContextCompat.checkSelfPermission(getContext(),Manifest.permission.ACCESS_FINE_LOCATION)==PackageManager.PERMISSION_GRANTED) {\r\n                l = mLocationManager.getLastKnownLocation(provider);\r\n            }\r\n            if (l == null) {\r\n                continue;\r\n            }\r\n            if (bestLocation == null || l.getAccuracy() < bestLocation.getAccuracy()) {\r\n                bestLocation = l;\r\n            }\r\n        }\r\n        return bestLocation;\r\n    }\r\n\r\n\r\n\r\n    private void showAlert() {\r\n        final AlertDialog.Builder dialog = new AlertDialog.Builder(getContext());\r\n        dialog.setTitle(\"Enable Location\")\r\n                .setMessage(\"Su ubicación esta desactivada.\\npor favor active su ubicación \" +\r\n                        \"usa esta app\")\r\n                .setPositiveButton(\"Configuración de ubicación\", new DialogInterface.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(DialogInterface paramDialogInterface, int paramInt) {\r\n                        Intent myIntent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);\r\n                        startActivity(myIntent);\r\n                    }\r\n                })\r\n                .setNegativeButton(\"Cancelar\", new DialogInterface.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(DialogInterface paramDialogInterface, int paramInt) {\r\n                    }\r\n                });\r\n        dialog.show();\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/bbsitter/bbsitter/OpcionesMenuCanguro/Inicio/MapsFragmentCanguros.java	(revision bb9206c915c383200da5cfd5aad8906c8d20faaf)
+++ app/src/main/java/com/bbsitter/bbsitter/OpcionesMenuCanguro/Inicio/MapsFragmentCanguros.java	(date 1606996725372)
@@ -202,7 +202,7 @@
 
         if (mapFragment != null) {
             mapFragment.getMapAsync(callback);
-            
+
 
         }
     }
